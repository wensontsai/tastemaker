<% if current_user.try(:admin?) %>

            <!--******************** NAVBAR ********************-->
            <div class="navbar-wrapper">
              <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="navbar-inner">
                  <div class="container">
                    <!-- Responsive Navbar Part 1: Button for triggering responsive navbar (not covered in tutorial). Include responsive CSS to utilize. -->
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a>
                    <h1 class="brand">

                      <%= link_to(Tastemaker, root_path) %>
                    </h1>
                    <!-- Responsive Navbar Part 2: Place all navbar contents you want collapsed withing .navbar-collapse.collapse. -->
                    <nav class="pull-right nav-collapse collapse">
                      <ul id="menu-main" class="nav">
                        <li><a href="#"><%= current_user.email %></a></li>

                      </ul>
                    </nav>
                  </div>
                  <!-- /.container -->
                </div>
                <!-- /.navbar-inner -->
              </div>
              <!-- /.navbar -->
            </div>
            <!-- /.navbar-wrapper -->


                  <!--main content -->

        <div class="body_stuff">
            <br><br><br>
          <h2>User Accounts </h2>
              <br>
                <table id="accounts_all">
                  <tr>
                    <th>USER ID</th>
                    <th>EMAIL</th>
                    <th>IS ADMIN?</th>
                    <th>APPROVED?</th>
                  </tr>
              <% @users = User.all %>
              <% @users.each do |user| %>
                        <tr id='row<%=user.id%>'>
                                <td><%= user.id %></td>
                                <td><%= user.email %></td>
                                <td><%= user.admin %></td>
                                <td><%= user.approved %></td>
                                <% if user.approved == false %>
                                  <td>
                                    <button id='approve_<%=user.id%>'>Approve Account [auto sends email]</button>
                                  </td>
                                <% end %>
                                <td>
                                  <button id='delete_<%=user.id%>'>Delete</button>
                                </td>
                        </tr>
                      <% end %>
                </table>

                <br><br>
                <div id="account_total">
                    total accounts = <%= @users.length %>
                </div>
        </div>

 <script>
        $(function() {

        var users_length = <%= @users.length %>;


          function updateLength() {
            $('#account_total').html('total accounts = ' +users_length)
          }


          function removeRow(id) {
            $('#row'+id).fadeOut();
            users_length--;

            updateLength();

            if(users_length === 0) {
              $('#accounts_all').html('there are no accounts right now');
            }
          }



          <% @users.each do |user| %>
            $('#delete_<%=user.id%>').click(function () {
              $.ajax({
                url: "<%=account_path(user.id)%>",
                type: "post",
                dataType: "json",
                data: {"_method":"delete"},
                success: function(response) {
                  if (response.success) {
                    removeRow(<%=user.id%>);
                  }else {
                    alert('deleting subscriber info failed, sorry!');
                  }
                }
              });
            });
          <% end %>


        });
        </script>

<% else %>

  You do not have administrator privileges.

<% end %>
